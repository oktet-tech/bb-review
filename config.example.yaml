# BB Review Configuration
# Copy this to config.yaml and fill in your values

# Review Board connection settings
reviewboard:
  url: "https://rb.example.com"
  
  # Authentication - choose ONE method:
  
  # Option 1: API token (get from Review Board > My Account > API Tokens)
  api_token: "${RB_API_TOKEN}"
  
  # Option 2: Username/password (for servers with Basic auth proxy)
  # username: "your-username"
  # password: "${RB_PASSWORD}"
  
  # Username of the bot account that triggers reviews
  bot_username: "ai-reviewer"

# LLM settings for code analysis
# Supported providers: anthropic, openrouter, openai
llm:
  # Option 1: Anthropic (direct)
  provider: "anthropic"
  model: "claude-sonnet-4-20250514"
  api_key: "${ANTHROPIC_API_KEY}"
  
  # Option 2: OpenRouter (uncomment to use)
  # provider: "openrouter"
  # model: "anthropic/claude-sonnet-4-20250514"  # or any model on openrouter.ai/models
  # api_key: "${OPENROUTER_API_KEY}"
  # base_url: "https://openrouter.ai/api/v1"  # optional, this is the default
  # site_url: "https://your-site.com"  # optional, for OpenRouter analytics
  # site_name: "BB Review"  # optional, for OpenRouter analytics
  
  # Option 3: OpenAI (uncomment to use)
  # provider: "openai"
  # model: "gpt-4o"
  # api_key: "${OPENAI_API_KEY}"
  
  # Common settings
  max_tokens: 4096
  temperature: 0.2  # Lower = more deterministic

# Repository configurations
# Map Review Board repository names to local paths
repositories:
  # Example:
  # - name: "myproject"
  #   rb_repo_name: "My Project"  # Name as shown in Review Board
  #   local_path: "/path/to/local/clone"
  #   remote_url: "git@github.com:org/myproject.git"
  #   default_branch: "main"
  #   review_method: "claude"  # Per-repo override: llm, opencode, or claude
  #   # Optional: Per-repo CocoIndex settings
  #   cocoindex:
  #     enabled: true  # Enable semantic indexing for this repo

# Polling settings (for automated mode)
polling:
  interval_seconds: 300  # 5 minutes
  max_reviews_per_cycle: 10

# State database for tracking processed reviews
database:
  path: "~/.bb_review/state.db"

# Logging settings
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  file: "~/.bb_review/bb_review.log"

# Default review settings (can be overridden per-repo in .ai-review.yaml)
defaults:
  focus:
    - bugs
    - security
  severity_threshold: "medium"
  auto_ship_it: false  # Whether to auto "Ship It" when no issues found

# OpenCode agent settings (alternative review mode)
# Use with: bb-review opencode <review_id>
opencode:
  enabled: false  # Set to true to enable opencode integration
  # model: "anthropic/claude-sonnet-4-20250514"  # Override model (optional)
  timeout: 300  # Timeout in seconds
  binary_path: "opencode"  # Path to opencode binary (or just "opencode" if in PATH)

# Claude Code CLI settings (alternative review mode)
# Use with: bb-review claude <review_id>
claude_code:
  enabled: false  # Set to true to enable Claude Code integration
  model: "claude-sonnet-4-5-20250929"  # Default model (sonnet 4.5)
  timeout: 600  # Timeout in seconds
  max_turns: 30  # Max agentic turns per review
  opus_max_turns: 50  # Max turns when model is opus (deeper reasoning needs more turns)
  binary_path: "claude"  # Path to claude binary (or just "claude" if in PATH)
  allowed_tools:  # Tools Claude Code is allowed to use during review
    - Read
    - Grep
    - Glob
    - Bash
  # mcp_config: .mcp.json  # MCP servers config (generate with: bb-review cocoindex setup --tool claude <repo>)

# Queue processing defaults
queue:
  method: "opencode"  # llm, opencode, or claude
  count: 5  # items to process per run

# Reviews database - stores analysis history for tracking and export
# Enables: bb-review db list/show/export/stats commands
review_db:
  enabled: false  # Set to true to enable reviews database
  path: "~/.bb_review/reviews.db"

# CocoIndex semantic code indexing settings
# Provides enhanced code search via MCP for OpenCode agents
# Setup: ./scripts/setup-cocoindex-db.sh start
# Install: uv pip install cocode-mcp
cocoindex:
  enabled: false  # Set to true to enable CocoIndex integration
  database_url: "postgresql://cocoindex:cocoindex@localhost:5432/cocoindex"
  log_dir: "~/.bb_review/cocoindex"  # Directory for CocoIndex logs
  # Embedding provider: openrouter (uses llm.api_key), jina, openai, or mistral
  embedding_provider: "openrouter"
  embedding_model: "mistralai/codestral-embed-2505"
  # embedding_api_key: "..."  # Optional, defaults to llm.api_key for openrouter
  chunk_size: 2000  # Characters per code chunk
  chunk_overlap: 400  # Overlap between chunks
